<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx | 前端知识总结</title>
    <meta name="description" content="我的个人网站">
    <link rel="icon" href="/logo.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.6211d1cb.css" as="style"><link rel="preload" href="/assets/js/app.1133204c.js" as="script"><link rel="preload" href="/assets/js/2.13d2b29b.js" as="script"><link rel="preload" href="/assets/js/51.b085194a.js" as="script"><link rel="prefetch" href="/assets/js/10.bcc27e89.js"><link rel="prefetch" href="/assets/js/11.1be181ba.js"><link rel="prefetch" href="/assets/js/12.1b43e140.js"><link rel="prefetch" href="/assets/js/13.c7fa3e69.js"><link rel="prefetch" href="/assets/js/14.6917256e.js"><link rel="prefetch" href="/assets/js/15.ff6bd572.js"><link rel="prefetch" href="/assets/js/16.a3aff470.js"><link rel="prefetch" href="/assets/js/17.174ca6e6.js"><link rel="prefetch" href="/assets/js/18.dfd95ff6.js"><link rel="prefetch" href="/assets/js/19.e445889b.js"><link rel="prefetch" href="/assets/js/20.998867d8.js"><link rel="prefetch" href="/assets/js/21.607d4de2.js"><link rel="prefetch" href="/assets/js/22.d43ac9dd.js"><link rel="prefetch" href="/assets/js/23.02540105.js"><link rel="prefetch" href="/assets/js/24.71b86e3f.js"><link rel="prefetch" href="/assets/js/25.11312555.js"><link rel="prefetch" href="/assets/js/26.5e926369.js"><link rel="prefetch" href="/assets/js/27.1118baca.js"><link rel="prefetch" href="/assets/js/28.3f10cb8c.js"><link rel="prefetch" href="/assets/js/29.44f67500.js"><link rel="prefetch" href="/assets/js/3.db27a041.js"><link rel="prefetch" href="/assets/js/30.44fe3cb4.js"><link rel="prefetch" href="/assets/js/31.91768b12.js"><link rel="prefetch" href="/assets/js/32.31c57b21.js"><link rel="prefetch" href="/assets/js/33.acbbb269.js"><link rel="prefetch" href="/assets/js/34.0ac641b3.js"><link rel="prefetch" href="/assets/js/35.6c8b17ea.js"><link rel="prefetch" href="/assets/js/36.9b7b068c.js"><link rel="prefetch" href="/assets/js/37.dee4b090.js"><link rel="prefetch" href="/assets/js/38.0e2bdd5d.js"><link rel="prefetch" href="/assets/js/39.b1e7f0b0.js"><link rel="prefetch" href="/assets/js/4.30c4a4e3.js"><link rel="prefetch" href="/assets/js/40.95055104.js"><link rel="prefetch" href="/assets/js/41.3841b5ff.js"><link rel="prefetch" href="/assets/js/42.758819cd.js"><link rel="prefetch" href="/assets/js/43.599ce5f4.js"><link rel="prefetch" href="/assets/js/44.0912f6d3.js"><link rel="prefetch" href="/assets/js/45.9515dc30.js"><link rel="prefetch" href="/assets/js/46.f2e4b360.js"><link rel="prefetch" href="/assets/js/47.af3a5ef4.js"><link rel="prefetch" href="/assets/js/48.a59301f5.js"><link rel="prefetch" href="/assets/js/49.d3640d53.js"><link rel="prefetch" href="/assets/js/5.261c279d.js"><link rel="prefetch" href="/assets/js/50.3cf880f4.js"><link rel="prefetch" href="/assets/js/52.db3fa364.js"><link rel="prefetch" href="/assets/js/53.ad3a9856.js"><link rel="prefetch" href="/assets/js/54.1db9b98b.js"><link rel="prefetch" href="/assets/js/55.4d65f7d9.js"><link rel="prefetch" href="/assets/js/56.6e3a28e6.js"><link rel="prefetch" href="/assets/js/57.32484d65.js"><link rel="prefetch" href="/assets/js/58.909bba51.js"><link rel="prefetch" href="/assets/js/6.6d50d38f.js"><link rel="prefetch" href="/assets/js/7.a2ba1025.js"><link rel="prefetch" href="/assets/js/8.49464530.js"><link rel="prefetch" href="/assets/js/9.bf01f6e1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6211d1cb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端知识总结</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/base/css/" class="nav-link">Css</a></li><li class="dropdown-item"><!----> <a href="/base/js/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/base/interview/" class="nav-link">汇总</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/frame/vue-router/" class="nav-link">Vue Router</a></li><li class="dropdown-item"><!----> <a href="/frame/vuex/" class="nav-link">VueX</a></li><li class="dropdown-item"><!----> <a href="/frame/element/" class="nav-link">Element</a></li><li class="dropdown-item"><!----> <a href="/frame/node/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/frame/miniprogram/" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/frame/angular/" class="nav-link">Angular1.6</a></li><li class="dropdown-item"><!----> <a href="/frame/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/frame/typescript/" class="nav-link">typescript</a></li><li class="dropdown-item"><!----> <a href="/frame/axios/" class="nav-link">axios</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/chrome/" class="nav-link">Chrome</a></li><li class="dropdown-item"><!----> <a href="/tools/npm/" class="nav-link">NPM</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/tools/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/tools/mac/" class="nav-link">Mac</a></li><li class="dropdown-item"><!----> <a href="/tools/nginx/" class="nav-link router-link-exact-active router-link-active">nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/setting/" class="nav-link">配置</a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/greybearchao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/base/css/" class="nav-link">Css</a></li><li class="dropdown-item"><!----> <a href="/base/js/" class="nav-link">JS</a></li><li class="dropdown-item"><!----> <a href="/base/interview/" class="nav-link">汇总</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/frame/vue-router/" class="nav-link">Vue Router</a></li><li class="dropdown-item"><!----> <a href="/frame/vuex/" class="nav-link">VueX</a></li><li class="dropdown-item"><!----> <a href="/frame/element/" class="nav-link">Element</a></li><li class="dropdown-item"><!----> <a href="/frame/node/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/frame/miniprogram/" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/frame/angular/" class="nav-link">Angular1.6</a></li><li class="dropdown-item"><!----> <a href="/frame/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/frame/typescript/" class="nav-link">typescript</a></li><li class="dropdown-item"><!----> <a href="/frame/axios/" class="nav-link">axios</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/chrome/" class="nav-link">Chrome</a></li><li class="dropdown-item"><!----> <a href="/tools/npm/" class="nav-link">NPM</a></li><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/tools/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/tools/mac/" class="nav-link">Mac</a></li><li class="dropdown-item"><!----> <a href="/tools/nginx/" class="nav-link router-link-exact-active router-link-active">nginx</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/setting/" class="nav-link">配置</a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/greybearchao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/tools/nginx/" class="active sidebar-link">nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tools/nginx/#基础用法" class="sidebar-link">基础用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tools/nginx/#代理至本地路径的文件" class="sidebar-link">代理至本地路径的文件</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#代理至其他端口" class="sidebar-link">代理至其他端口</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#绝对路径和相对路径匹配" class="sidebar-link">绝对路径和相对路径匹配</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#匹配规则和优先级" class="sidebar-link">匹配规则和优先级</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#root-和-alias" class="sidebar-link">root 和 alias</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#使用nginx解决跨域问题" class="sidebar-link">使用nginx解决跨域问题</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#index的理解" class="sidebar-link">index的理解</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#rewrite的理解" class="sidebar-link">rewrite的理解</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#常用变量" class="sidebar-link">常用变量</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#if-的用法" class="sidebar-link">if 的用法</a></li><li class="sidebar-sub-header"><a href="/tools/nginx/#设置防盗链" class="sidebar-link">设置防盗链</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="基础用法"><a href="#基础用法" class="header-anchor">#</a> 基础用法</h2> <h3 id="代理至本地路径的文件"><a href="#代理至本地路径的文件" class="header-anchor">#</a> 代理至本地路径的文件</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>server <span class="token punctuation">{</span>
  server_name localhost<span class="token punctuation">;</span>
  listen <span class="token number">80</span><span class="token punctuation">;</span>
  location <span class="token operator">/</span> <span class="token punctuation">{</span>
    root <span class="token operator">/</span>Users<span class="token operator">/</span>careerfrog<span class="token operator">/</span>test<span class="token punctuation">;</span>
    index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将 localhost:80 代理至本地的 /Users/careerfrog/test/index.html</span>
nginx <span class="token operator">-</span>s reload <span class="token comment">// 重启nginx</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="代理至其他端口"><a href="#代理至其他端口" class="header-anchor">#</a> 代理至其他端口</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>server <span class="token punctuation">{</span>
  server_name localhost<span class="token punctuation">;</span>
  listen <span class="token number">80</span><span class="token punctuation">;</span>
  location <span class="token operator">/</span> <span class="token punctuation">{</span>
    proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.99</span><span class="token number">.239</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token punctuation">;</span> <span class="token comment">// 或 http://localhost:8000;</span>
    index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将 localhost:80 代理至 http://192.168.99.239:8000;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="绝对路径和相对路径匹配"><a href="#绝对路径和相对路径匹配" class="header-anchor">#</a> 绝对路径和相对路径匹配</h3> <ol><li>如果在proxy_pass后面的url加/，表示绝对根路径；</li> <li>如果没有/，表示相对路径，把匹配的路径部分也给代理走。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 例1:</span>
server <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  location <span class="token operator">/</span>a<span class="token operator">/</span> <span class="token punctuation">{</span>
    proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token punctuation">;</span> <span class="token comment">// 不加 /</span>
    index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token number">1.</span> localhost<span class="token operator">/</span>a<span class="token operator">/</span>   <span class="token operator">=&gt;</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>a<span class="token operator">/</span>index<span class="token punctuation">.</span>html
<span class="token number">2.</span> localhost<span class="token operator">/</span>a<span class="token operator">/</span>b<span class="token operator">/</span> <span class="token operator">=&gt;</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>a<span class="token operator">/</span>b<span class="token operator">/</span>index<span class="token punctuation">.</span>html

<span class="token comment">// 例2:</span>
server <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  location <span class="token operator">/</span>a<span class="token operator">/</span> <span class="token punctuation">{</span>
    proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/localhost:8000/</span><span class="token punctuation">;</span> <span class="token comment">// 加 /</span>
    index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token number">1.</span> localhost<span class="token operator">/</span>a<span class="token operator">/</span>   <span class="token operator">=&gt;</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>index<span class="token punctuation">.</span>html
<span class="token number">2.</span> localhost<span class="token operator">/</span>a<span class="token operator">/</span>b<span class="token operator">/</span> <span class="token operator">=&gt;</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>b<span class="token operator">/</span>index<span class="token punctuation">.</span>html

<span class="token comment">// 例3:</span>
server <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  location <span class="token operator">/</span>a<span class="token operator">/</span> <span class="token punctuation">{</span>
    proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>c<span class="token operator">/</span><span class="token punctuation">;</span> <span class="token comment">// 加 /</span>
    index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

localhost<span class="token operator">/</span>a<span class="token operator">/</span><span class="token number">1.</span><span class="token parameter">jpg</span> <span class="token operator">=&gt;</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>c<span class="token operator">/</span><span class="token number">1.</span>jpg<span class="token punctuation">;</span>

<span class="token comment">// 例4:</span>
server <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  location <span class="token operator">/</span>a<span class="token operator">/</span> <span class="token punctuation">{</span>
    proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>c<span class="token punctuation">;</span> <span class="token comment">// 不加 /</span>
    index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

localhost<span class="token operator">/</span>a<span class="token operator">/</span><span class="token number">1.</span><span class="token parameter">jpg</span> <span class="token operator">=&gt;</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>c1<span class="token punctuation">.</span>jpg<span class="token punctuation">;</span>（未附加<span class="token operator">/</span>a<span class="token operator">/</span>路径，但附加了<span class="token operator">/</span>a<span class="token operator">/</span>之后的路径）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="匹配规则和优先级"><a href="#匹配规则和优先级" class="header-anchor">#</a> 匹配规则和优先级</h3> <table><thead><tr><th>模式</th> <th>含义</th></tr></thead> <tbody><tr><td>location = /uri</td> <td>= 表示精确匹配，只有完全匹配上才能生效</td></tr> <tr><td>location ^~ /uri</td> <td>^~ 开头对URL路径进行前缀匹配，并且在正则之前。</td></tr> <tr><td>location ~ pattern</td> <td>开头表示区分大小写的正则匹配</td></tr> <tr><td>location ~* pattern</td> <td>开头表示不区分大小写的正则匹配</td></tr> <tr><td>location /uri</td> <td>不带任何修饰符，也表示前缀匹配，但是在正则匹配之后</td></tr> <tr><td>location /</td> <td>通用匹配，任何未匹配到其它location的请求都会匹配到，相当于switch中的default</td></tr></tbody></table> <h4 id="优先级"><a href="#优先级" class="header-anchor">#</a> 优先级</h4> <ol><li>首先精确匹配 =</li> <li>其次前缀匹配 ^~</li> <li>其次是按文件中顺序的正则匹配</li> <li>然后匹配不带任何修饰的前缀匹配。</li> <li>最后是交给 / 通用匹配</li> <li>当有匹配成功时候，停止匹配，按当前匹配规则处理请求</li></ol> <h4 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>location <span class="token operator">=</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
   #规则<span class="token constant">A</span>
<span class="token punctuation">}</span>
location <span class="token operator">=</span> <span class="token operator">/</span>login <span class="token punctuation">{</span>
   #规则<span class="token constant">B</span>
<span class="token punctuation">}</span>
location <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span> <span class="token punctuation">{</span>
   #规则<span class="token constant">C</span>
<span class="token punctuation">}</span>
location <span class="token operator">~</span> \<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>js<span class="token operator">|</span>css<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
   #规则<span class="token constant">D</span>
<span class="token punctuation">}</span>
location <span class="token operator">~</span><span class="token operator">*</span> \<span class="token punctuation">.</span>png$ <span class="token punctuation">{</span>
   #规则<span class="token constant">E</span>
<span class="token punctuation">}</span>
location <span class="token operator">!</span><span class="token operator">~</span> \<span class="token punctuation">.</span>xhtml$ <span class="token punctuation">{</span>
   #规则<span class="token constant">F</span>
<span class="token punctuation">}</span>
location <span class="token operator">!</span><span class="token operator">~</span><span class="token operator">*</span> \<span class="token punctuation">.</span>xhtml$ <span class="token punctuation">{</span>
   #规则<span class="token constant">G</span>
<span class="token punctuation">}</span>
location <span class="token operator">/</span> <span class="token punctuation">{</span>
   #规则<span class="token constant">H</span>
<span class="token punctuation">}</span>

那么产生的效果如下：

访问根目录<span class="token operator">/</span>， 比如http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span> 将匹配规则<span class="token constant">A</span>
访问 http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>login 将匹配规则<span class="token constant">B</span>，http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>register 则匹配规则<span class="token constant">H</span>
访问 http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span>a<span class="token punctuation">.</span>html 将匹配规则<span class="token constant">C</span>
访问 http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>a<span class="token punctuation">.</span>gif<span class="token punctuation">,</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>b<span class="token punctuation">.</span>jpg 将匹配规则<span class="token constant">D</span>和规则<span class="token constant">E</span>，但是规则<span class="token constant">D</span>顺序优先，规则<span class="token constant">E</span>不起作用，而http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span>c<span class="token punctuation">.</span>png 则优先匹配到规则<span class="token constant">C</span>
访问 http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>a<span class="token punctuation">.</span><span class="token constant">PNG</span> 则匹配规则<span class="token constant">E</span>，而不会匹配规则<span class="token constant">D</span>，因为规则<span class="token constant">E</span>不区分大小写。
访问 http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>a<span class="token punctuation">.</span>xhtml 不会匹配规则<span class="token constant">F</span>和规则<span class="token constant">G</span>，http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>a<span class="token punctuation">.</span><span class="token constant">XHTML</span>不会匹配规则<span class="token constant">G</span>，因为不区分大小写。规则<span class="token constant">F</span>，规则<span class="token constant">G</span>属于排除法，符合匹配规则但是不会匹配到，所以想想看实际应用中哪里会用到。
访问 http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">/</span>category<span class="token operator">/</span>id<span class="token operator">/</span><span class="token number">1111</span> 则最终匹配到规则<span class="token constant">H</span>，因为以上规则都不匹配，这个时候应该是nginx转发请求给后端应用服务器，比如FastCGI（php），tomcat（jsp），nginx作为反向代理服务器存在。

建议设置的匹配规则：

第一个必选规则
location <span class="token operator">=</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
  proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>tomcat<span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span>index
<span class="token punctuation">}</span>

第二个必选规则是处理静态文件请求，这是nginx作为http服务器的强项，有两种配置模式，目录匹配或后缀匹配<span class="token punctuation">,</span>任选其一或搭配使用
location <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span> <span class="token punctuation">{</span>
  root <span class="token operator">/</span>webroot<span class="token operator">/</span><span class="token keyword">static</span><span class="token operator">/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
location <span class="token operator">~</span><span class="token operator">*</span> <span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>jpeg<span class="token operator">|</span>png<span class="token operator">|</span>css<span class="token operator">|</span>js<span class="token operator">|</span>ico<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
  root <span class="token operator">/</span>webroot<span class="token operator">/</span>res<span class="token operator">/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

第三个规则就是通用规则，用来转发动态请求到后端应用服务器，非静态文件请求就默认是动态请求。
location <span class="token operator">/</span> <span class="token punctuation">{</span>
  proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/tomcat:8080/</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="root-和-alias"><a href="#root-和-alias" class="header-anchor">#</a> root 和 alias</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span>root<span class="token punctuation">]</span>
语法：root path
默认值：root html
配置段：http、server、location、<span class="token keyword">if</span>
<span class="token punctuation">[</span>alias<span class="token punctuation">]</span>
语法：alias path
配置段：location
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>作用：映射到本机的文件。（只能是本机上的文件）</p> <ol><li>root的处理结果是：root路径＋location路径。</li> <li>alias的处理结果是：使用alias路径替换location路径。</li> <li>alias后面必须要用“/”结束，而root可有可无。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用 root</span>
server <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  location <span class="token operator">/</span>a<span class="token operator">/</span> <span class="token punctuation">{</span>
    root <span class="token operator">/</span>Users<span class="token operator">/</span>careerfrog<span class="token operator">/</span>test<span class="token punctuation">;</span>
    index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

localhost<span class="token operator">/</span>a<span class="token operator">/</span> <span class="token operator">=&gt;</span> <span class="token operator">/</span>Users<span class="token operator">/</span>careerfrog<span class="token operator">/</span>test<span class="token operator">/</span>a<span class="token operator">/</span>index<span class="token punctuation">.</span>html

<span class="token comment">// 使用 alias</span>
server <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  location <span class="token operator">/</span>a<span class="token operator">/</span> <span class="token punctuation">{</span>
    alias <span class="token operator">/</span>Users<span class="token operator">/</span>careerfrog<span class="token operator">/</span>test<span class="token operator">/</span><span class="token punctuation">;</span>
    index index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

localhost<span class="token operator">/</span>a<span class="token operator">/</span> <span class="token operator">=&gt;</span> <span class="token operator">/</span>Users<span class="token operator">/</span>careerfrog<span class="token operator">/</span>test<span class="token operator">/</span>index<span class="token punctuation">.</span>html

<span class="token comment">/** 如果写成:
 * alias /Users/careerfrog/test; 使用 nginx -t 检查语法错误时并不会报错。
 * 但是在访问时会报 403 Forbidden。
 * /
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="使用nginx解决跨域问题"><a href="#使用nginx解决跨域问题" class="header-anchor">#</a> 使用nginx解决跨域问题</h3> <p>前端调用：http://localhost:8886/api/users</p> <p>后端接口：http://localhost:8888/users</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>server <span class="token punctuation">{</span>
  server_name localhost<span class="token punctuation">;</span>
  listen <span class="token number">8886</span><span class="token punctuation">;</span>
  location <span class="token operator">/</span>api<span class="token operator">/</span> <span class="token punctuation">{</span>
    proxy_pass http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/localhost:8888/</span><span class="token punctuation">;</span>
    add_header <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span><span class="token punctuation">;</span> <span class="token comment">// 解决跨域问题</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>将项目文件夹置于：/usr/local/var/www/ 下</p> <p>访问路径：localhost:8886/project/</p> <h3 id="index的理解"><a href="#index的理解" class="header-anchor">#</a> index的理解</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>server <span class="token punctuation">{</span>
  listen      <span class="token number">80</span><span class="token punctuation">;</span>
  server_name example<span class="token punctuation">.</span>org www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>org<span class="token punctuation">;</span>    
  
  location <span class="token operator">/</span> <span class="token punctuation">{</span>
    root    <span class="token operator">/</span>data<span class="token operator">/</span>www<span class="token punctuation">;</span>
    index   index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>php<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  location <span class="token operator">~</span> \<span class="token punctuation">.</span>php$ <span class="token punctuation">{</span>
    root    <span class="token operator">/</span>data<span class="token operator">/</span>www<span class="token operator">/</span>test<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果你使用example.org或www.example.org直接发起请求，那么首先会访问到“/”的location，结合root与index指令，会先判断/data/www/index.html是否存在，如果不，则接着查看
/data/www/index.php ，如果存在，则使用/index.php发起内部重定向，就像从客户端再一次发起请求一样，Nginx会再一次搜索location，毫无疑问匹配到第二个~ .php$，从而访问到/data/www/test/index.php。</p> <h3 id="rewrite的理解"><a href="#rewrite的理解" class="header-anchor">#</a> rewrite的理解</h3> <p>执行顺序：</p> <ol><li>执行server块的rewrite指令。</li> <li>执行location匹配。</li> <li>执行选定的location中的rewrite指令。</li> <li>如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件；循环超过10次，则返回500 Internal Server Error错误。</li></ol> <h4 id="flag-标志位"><a href="#flag-标志位" class="header-anchor">#</a> flag 标志位</h4> <ol><li>last – 立刻跳出本 location 的匹配，同时会顺序继续搜寻其他 location 的匹配，如果还没匹配到，还会继续搜寻本 location。</li> <li>break – 中止Rewirte，不在继续匹配（跳出本 location 后就不会再匹配其它 location 了）。</li> <li>redirect – 返回临时重定向的HTTP状态302</li> <li>permanent – 返回永久重定向的HTTP状态301</li></ol> <p>break和last都能组织继续执行后面的rewrite指令。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 例1:</span>
location <span class="token operator">/</span> <span class="token punctuation">{</span>
  rewrite <span class="token operator">^</span><span class="token operator">/</span>a <span class="token operator">/</span>b last<span class="token punctuation">;</span>
  rewrite <span class="token operator">^</span><span class="token operator">/</span>b <span class="token operator">/</span>c last<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

location <span class="token operator">=</span> <span class="token operator">/</span>b <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">401</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

location <span class="token operator">=</span> <span class="token operator">/</span>c <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">402</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

如果访问 https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>simplehttps<span class="token punctuation">.</span>com<span class="token operator">/</span>a<span class="token operator">/</span>，则返回 <span class="token number">401</span>；
如果访问 https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>simplehttps<span class="token punctuation">.</span>com<span class="token operator">/</span>b<span class="token operator">/</span>，则返回 <span class="token number">402</span>。

<span class="token comment">// 例2:</span>
location <span class="token operator">/</span> <span class="token punctuation">{</span>
  rewrite <span class="token operator">^</span><span class="token operator">/</span>a <span class="token operator">/</span>b <span class="token keyword">break</span><span class="token punctuation">;</span>
  rewrite <span class="token operator">^</span><span class="token operator">/</span>b <span class="token operator">/</span>c <span class="token keyword">break</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

location <span class="token operator">=</span> <span class="token operator">/</span>b <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">401</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

location <span class="token operator">=</span> <span class="token operator">/</span>c <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">402</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

访问 https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>simplehttps<span class="token punctuation">.</span>com<span class="token operator">/</span>a<span class="token operator">/</span> 和 https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>simplehttps<span class="token punctuation">.</span>com<span class="token operator">/</span>b<span class="token operator">/</span>，都返回 <span class="token number">404</span>。

<span class="token comment">// 例3:</span>
flag 配置在 server 段时，不管是 <span class="token keyword">break</span> 还是 last，其行为规则是一样的，不会有跳出的行为，会顺序执行。

rewrite <span class="token operator">^</span><span class="token operator">/</span>a <span class="token operator">/</span>b <span class="token keyword">break</span><span class="token punctuation">;</span> # 或者 rewrite <span class="token operator">^</span><span class="token operator">/</span>a <span class="token operator">/</span>b last<span class="token punctuation">;</span>
rewrite <span class="token operator">^</span><span class="token operator">/</span>b <span class="token operator">/</span>c <span class="token keyword">break</span><span class="token punctuation">;</span> # 或者 rewrite <span class="token operator">^</span><span class="token operator">/</span>b <span class="token operator">/</span>c last<span class="token punctuation">;</span>  

location <span class="token operator">=</span> <span class="token operator">/</span>b <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">401</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

location <span class="token operator">=</span> <span class="token operator">/</span>c <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">402</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h4 id="english"><a href="#english" class="header-anchor">#</a> English</h4> <ol><li>last：stops processing the current set of ngx_http_rewrite_module directives and starts a search for a new location matching the changed URI;</li> <li>break：stops processing the current set of ngx_http_rewrite_module directives as with the break directive;</li> <li>redirect：returns a temporary redirect with the 302 code;</li> <li>permanent：returns a permanent redirect with the 301 code.</li></ol> <h4 id="rewrite-和-location-的区别"><a href="#rewrite-和-location-的区别" class="header-anchor">#</a> rewrite 和 location 的区别</h4> <p>rewrite是在同一域名内更改获取资源的路径，而location是对一类路径做控制访问或反向代理，可以proxy_pass到其他机器。</p> <h4 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>location <span class="token operator">/</span> <span class="token punctuation">{</span>
  rewrite <span class="token operator">^</span><span class="token operator">/</span>test<span class="token operator">/</span> <span class="token operator">/</span>test1<span class="token operator">/</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token comment">// rewrite ^/test /test1/ break; 无效</span>
  <span class="token comment">// rewrite ^/test/ /test1 break; 无效</span>
  <span class="token comment">// rewrite ^/test /test1 break; 无效</span>
  <span class="token comment">// rewrite ^/test/ /test/a/ break; 无效</span>
<span class="token punctuation">}</span>

<span class="token comment">// curl -i http://localhost:8000/test/ =&gt; http://localhost:8000/test1/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="常用变量"><a href="#常用变量" class="header-anchor">#</a> 常用变量</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$args ： #这个变量等于请求行中的参数，同$query_string
$content_length ： 请求头中的Content<span class="token operator">-</span>length字段。
$content_type ： 请求头中的Content<span class="token operator">-</span>Type字段。
$document_root ： 当前请求在root指令中指定的值。
$host ： 请求主机头字段，否则为服务器名称。
$http_user_agent ： 客户端agent信息
$http_cookie ： 客户端cookie信息
$limit_rate ： 这个变量可以限制连接速率。
$status  请求状态
$body_bytes_sent 发送字节
$request_method ： 客户端请求的动作，通常为<span class="token constant">GET</span>或<span class="token constant">POST</span>。
$remote_addr ： 客户端的<span class="token constant">IP</span>地址。
$remote_port ： 客户端的端口。
$remote_user ： 已经经过Auth Basic Module验证的用户名。
$request_filename ： 当前请求的文件路径，由root或alias指令与<span class="token constant">URI</span>请求生成。
$scheme ： <span class="token constant">HTTP</span>方法（如http，https）。
$server_protocol ： 请求使用的协议，通常是<span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.0</span>或<span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>。
$server_addr ： 服务器地址，在完成一次系统调用后可以确定这个值。
$server_name ： 服务器名称。
$server_port ： 请求到达服务器的端口号。
$request_uri ： 包含请求参数的原始<span class="token constant">URI</span>，不包含主机名，如：”<span class="token operator">/</span>foo<span class="token operator">/</span>bar<span class="token punctuation">.</span>php<span class="token operator">?</span>arg<span class="token operator">=</span>baz”。
$uri ： 不带请求参数的当前<span class="token constant">URI</span>，$uri不包含主机名，如”<span class="token operator">/</span>foo<span class="token operator">/</span>bar<span class="token punctuation">.</span>html”。
$document_uri ： 与$uri相同。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="if-的用法"><a href="#if-的用法" class="header-anchor">#</a> if 的用法</h3> <ol><li>当表达式只是一个变量时，如果值为空或任何以0开头的字符串都会当做false。</li> <li>直接比较变量和内容时，使用 = 或 !=。</li> <li>~ 正则表达式匹配，~* 不区分大小写的匹配，!~ 区分大小写的不匹配。</li></ol> <p>可用来判断的表达式：</p> <ol><li>-f和!-f用来判断是否存在文件。</li> <li>-d和!-d用来判断是否存在目录。</li> <li>-e和!-e用来判断是否存在文件或目录。</li> <li>-x和!-x用来判断文件是否可执行。</li></ol> <h3 id="设置防盗链"><a href="#设置防盗链" class="header-anchor">#</a> 设置防盗链</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>location <span class="token operator">/</span> <span class="token punctuation">{</span>
  valid_referers none blocked <span class="token number">192.168</span><span class="token number">.99</span><span class="token number">.239</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>$invalid_referer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// curl -e 192.168.99.239  -I localhost:8000/test/  =&gt; 200</span>
<span class="token comment">// curl -e www.baidu.com -I localhost:8000/test/ =&gt; 200</span>
<span class="token comment">// curl -e https://www.baidu.com -I localhost:8000/test/ =&gt; 403</span>

<span class="token operator">-</span>e：设置 <span class="token constant">HTTP</span> 的标头Referer，表示请求的来源（必须设置http或者https才有效）。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># 图片、视频等防盗链设置</span>
<span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">+</span>\<span class="token punctuation">.</span><span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>swf<span class="token operator">|</span><span class="token keyword">flv</span><span class="token operator">|</span>rar<span class="token operator">|</span>zip<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
  <span class="token keyword">valid_referers</span> none blocked <span class="token number">192.168</span><span class="token number">.99</span><span class="token number">.239</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$invalid_referer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">403</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1133204c.js" defer></script><script src="/assets/js/2.13d2b29b.js" defer></script><script src="/assets/js/51.b085194a.js" defer></script>
  </body>
</html>
